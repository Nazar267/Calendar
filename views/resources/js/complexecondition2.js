/*!
 * Complexe Condition Component
 * 
 * Version 3.2
 * 
 * Changelog
 * 3.2 - Move to Webpack Compiler
 * 3.1 - Standalone development
 *     - JS Strict Mode
 *     - Gulp Scripts
 * 3.0 - Compatibility to Reports functions
 * 2.3 - Rework for Standalone task
 * 2.3.1 - 2017-08-17
 *       - Add option to set fieldname prefix
 *       - Make InitAutocompleteText optional
 * 
 * Handling
 *     Require FlexTranslate in current Scope
 *     Require set of ConditionScopeModule to current Module
 *     Require jquery.form.min.js inside views/resources of ConditionScopeModule
 *     Condition Popup needs "ComplexeCondition" action in ConditionScopeModule/action
 *     Condition Popup needs "ComplexeCondition" view in ConditionScopeModule/views
 *     Condition Popup needs "ConditionPopup.tpl" Template in ConditionScopeModule
 *     Include complexcondition.css into current view
 * 
 */!function(e){var i={};function t(n){if(i[n])return i[n].exports;var o=i[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,t),o.l=!0,o.exports}t.m=e,t.c=i,t.d=function(e,i,n){t.o(e,i)||Object.defineProperty(e,i,{enumerable:!0,get:n})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,i){if(1&i&&(e=t(e)),8&i)return e;if(4&i&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(t.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&i&&"string"!=typeof e)for(var o in e)t.d(n,o,function(i){return e[i]}.bind(null,o));return n},t.n=function(e){var i=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(i,"a",i),i},t.o=function(e,i){return Object.prototype.hasOwnProperty.call(e,i)},t.p="modules/ComponentExample/dist/",t(t.s="70gy")}({"70gy":function(e,i,t){"use strict";function n(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}t.r(i);var o=function(e,i,t,o){null==t&&(t=""),0==i&&(i=e.replace(/[^a-zA-Z0-9_]+/g,"_")),void 0===o&&(o={}),void 0===o.module&&"undefined"!=typeof moduleName&&(o.module=moduleName),void 0===o.refFields&&(o.refFields=!1),void 0===o.mode&&(o.mode=""),void 0===o.class&&(o.class=""),void 0===o.style&&(o.style=""),void 0===o.disabled||0==o.disabled?o.disabled="":o.disabled="disabled='disabled'",void 0===o.type&&(o.type="0"),void 0===o.uitype&&(o.uitype=[]),void 0===o.delimiter&&(o.delimiter=""),void 0===o.title&&(o.title=""),void 0===o.datalist&&(o.datalist=""),void 0===o.fieldType&&(o.fieldType="text"),void 0===o.readonly&&(o.readonly=!1),void 0===o.placeholder&&(o.placeholder=""),void 0===o.variables&&(o.variables=!0),void 0===o.width&&(o.width="600px"),void 0===o.module&&(o.module=""),void 0===o.dataAttr&&(o.dataAttr=!1),o.class+=" condition_value text textfield templateField initAutocomplete form-control";var a="";jQuery.each(o.dataAttr,(function(e,i){a+=" data-"+e+'="'+i+'"'}));var l=o.uitype.join(","),s="<input autocomplete='false' type='"+o.fieldType+"' data-currentvalue='"+n(t)+"' "+a+" "+(""!==o.datalist?'list="'+o.datalist+'"':"")+" title='"+o.title+"' placeholder='"+o.placeholder+"'  alt='"+o.title+"' data-delimiter='"+o.delimiter+"' ondblclick='dblClickTextfield(\""+i+"\");' "+o.disabled+"style='width:100% !important;float:left;"+o.style+"' data-module='"+o.module+"' class='"+o.class+"' name='"+e+"' id='"+i+"' "+(!0===o.readonly?'readonly="readonly"':"")+' value="'+(!1!==t?n(t):"")+'">';return 1==o.variables&&("expression"!=o.mode?s+="<span class='templateFieldBtn templateFieldButton' data-references='([source]: ([module]) [destination])' data-functions='true' data-replace='false' data-options='{\"refFields\":\""+o.refFields+'", "module": "'+o.module+'", "uitypes": "'+l+'", "type":"'+o.type+"\"}' ><img src='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAQAAAC1+jfqAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAAmJLR0QAAKqNIzIAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAAHdElNRQfjBA8CIxxYy4paAAAAnElEQVQoz5WRsQ4BQRRFDzaUVBpbS0Qi0fkBH0Gz/ooOP6RSa9b4ACKxJHs1GztPZiTONPPunLzkvQGfFRfOLImQ8kKIgn4dNo2QANBmEO7Q4YgQh0oEoGGULhkle2511DJCwZ0Tjig7hNjEnieoOsPwFArcvtgixJofjBnZIDFVjzkljusfi/KZfaaYhoWUJ0I8/M+yZDhyFn70BtrhMDokCc6yAAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDE5LTA0LTE1VDAwOjM1OjI4KzAyOjAwZI0qbAAAACV0RVh0ZGF0ZTptb2RpZnkAMjAxOS0wNC0xNVQwMDozNToyOCswMjowMBXQktAAAAAZdEVYdFNvZnR3YXJlAHd3dy5pbmtzY2FwZS5vcmeb7jwaAAAAAElFTkSuQmCC' id='templateIcon_"+i+"'  style='margin-bottom:-5px;cursor:pointer;'></span>":s+="<span class='templateFieldBtn templateFieldButton' data-references='[source]->[module]->[destination]' data-functions='false' data-replace='false' data-options='{\"module\": \""+o.module+"\"}'  id='task_condition_iconspan'><img src='modules/Workflow2/icons/templatefieldPHP.png' style='margin-bottom:-2px;cursor:pointer;'>"),"<span class='templateFieldSpan'>"+s+"</span>"};function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,i){for(var t=0;t<i.length;t++){var n=i[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var s=function(){function e(i,t){!function(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}(this,e),this.complexeConditionObj=i,void 0===t&&(t=!1),this.parentGroup=t,this.elementIndex=this.parentGroup.getFreeElementIndex(),this.fieldNamePrefix=this.parentGroup.getGroupPrefix()+"["+this.elementIndex+"]",this.fieldIdPrefix=this.parentGroup.getGroupIdPrefix()+"_"+this.elementIndex,this.container=null,this.initializeConditionValues={}}var i,t,s;return i=e,(t=[{key:"appendTo",value:function(e){var i="";i+="<div class='ConditionalItem ConditionalRecord "+(!0===this.complexeConditionObj.isInitialized()?"NewConditionalRecord":"")+"'>",i+="<img class='ConditionRemove' src='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAQAAAC1+jfqAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAAmJLR0QAAKqNIzIAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAAHdElNRQfjBA4NCASON889AAAAUElEQVQoz2NgSGZ4z/AfB3zPkMTI8J6BleEGA3agwfCbgeE/wzEGXOA4w38mBgKAjgpSGZ6gwVSIBAtc6X9cZgwBbxKKrF8MDEl4ovsdQyIAAmIzIBOr6dYAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTktMDQtMTRUMTE6MDg6MDQrMDI6MDBj5QO2AAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE5LTA0LTE0VDExOjA4OjA0KzAyOjAwEri7CgAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAASUVORK5CYII=' alt='delete'>";var t="f_"+this.fieldIdPrefix;!1===this.complexeConditionObj.IsDynamicFieldLoader()?i+="<select class='ConditionField MakeSelect2' name='"+this.fieldNamePrefix+"[field]' id='"+t+"_field'>"+this.complexeConditionObj.getFieldOptions()+"</select>":i+="<input type='hidden' class='ConditionField MakeHiddenSelect2' name='"+this.fieldNamePrefix+"[field]'  id='"+t+"_field' />",!0===this.complexeConditionObj.IsValueModifiersVisible()&&(i+="<select class='ConditionMod' name='"+this.fieldNamePrefix+"[mod]' id='"+t+"_modification'></select><br/>"),i+="<select class='ConditionNot' name='"+this.fieldNamePrefix+"[not]' id='"+t+"_not'><option value='0'>-</option><option value='1'>"+this.complexeConditionObj.__("LBL_NOT")+"</option></select>",i+="<select class='ConditionOperation' name='"+this.fieldNamePrefix+"[operation]' id='"+t+"_operation'><option value=''>_</option></select>",i+='<select class="ConditionMode" '+(!1===this.complexeConditionObj.IsConditionModeVisible()?'style="display:none;"':"")+' name="'+this.fieldNamePrefix+'[mode]" id="'+t+'_mode"><option value="value">'+this.complexeConditionObj.__("LBL_STATIC_VALUE")+'</option><option value="function">'+this.complexeConditionObj.__("LBL_FUNCTION_VALUE")+"</option></select>",i+="<div class='ConditionContainer'></div>",i+="</div>",i+=this.complexeConditionObj.generateJOINSelect("",!1),this.container=$(i),this.container.data("item",this),$(e).append(this.container),this.parentGroup.checkJoinDisabled(),jQuery(".NewConditionalRecord",e).css("display","flex"),jQuery(".NewConditionalRecord",e).removeClass("NewConditionalRecord"),jQuery(".ConditionField",this.container).on("change",jQuery.proxy(this.updateSelectedField,this)),jQuery(".ConditionMod",this.container).on("change",jQuery.proxy(this.updateSelectedField,this)),jQuery(".ConditionOperation",this.container).on("change",jQuery.proxy(this.updateOperationField,this)),jQuery(".ConditionMode",this.container).on("change",jQuery.proxy(this.updateOperationField,this)),jQuery(".ConditionRemove",this.container).on("click",jQuery.proxy(this.removeCondition,this)),jQuery(".ConditionalJoin").off("change").on("change",this.complexeConditionObj.ChangeJoin),jQuery(".ConditionalRecord",this.container).on("mouseover",jQuery.proxy((function(e){var i=e.target;jQuery(i).hasClass("ConditionalRecord")||(i=jQuery(i).closest(".ConditionalRecord")),jQuery(".ConditionalRecordHover",this.parentEle).removeClass("ConditionalRecordHover"),jQuery(i).addClass("ConditionalRecordHover")}),this)),jQuery(".ConditionalGroup",this.container).on("mouseover",jQuery.proxy((function(e){var i=e.target;jQuery(i).hasClass("ConditionalGroup")||(i=jQuery(i).closest(".ConditionalGroup")),jQuery(".ConditionalGroupHover",this.parentEle).removeClass("ConditionalGroupHover"),jQuery(i).addClass("ConditionalGroupHover")}),this)),jQuery(".ConditionField",this.container).trigger("change"),this.complexeConditionObj.InitSelect2()}},{key:"getNot",value:function(){return $(".ConditionNot",this.container).val()}},{key:"getOperation",value:function(){return jQuery(".ConditionOperation",this.container).val()}},{key:"getModifier",value:function(){return jQuery(".ConditionMod",this.container).val()}},{key:"getMode",value:function(){return jQuery(".ConditionMode",this.container).val()}},{key:"getField",value:function(){return jQuery(".ConditionField",this.container).select2("val")}},{key:"getElementIndex",value:function(){return this.elementIndex}},{key:"getValues",value:function(){var e={};return jQuery(".ConditionValue",this.container).each((function(i,t){var n=$(t).data("name");void 0!==n&&void 0===e[n]&&(e[n]=$(t).val())})),e}},{key:"isGroup",value:function(){return!1}},{key:"initialize",value:function(e){null!==e.field&&void 0!==e.field&&void 0!==e&&(void 0!==e.rawvalue&&null!==e.rawvalue&&(this.initializeConditionValues=e.rawvalue),$(".ConditionNot",this.container).val(e.not),$(".ConditionMode",this.container).val(e.mode),$(".ConditionField",this.container).val(e.field).trigger("change"),$(".ConditionMod",this.container).val(e.mod).trigger("change"),$(".ConditionOperation",this.container).val(e.operation).trigger("change"),$(".ConditionMode",this.container).val(e.mode).trigger("change"),this.initializeConditionValues={})}},{key:"removeCondition",value:function(e){var i=this;this.container.slideUp("fast",(function(){jQuery(i).remove(),i.parentGroup.checkJoinDisabled()}))}},{key:"updateOperationField",value:function(e){var i=this.getSelectedOperator(),t=this.getSelectedField(),l=this.getSelectedMode();-1==i.indexOf("/")&&""!=i&&("bigger"==i&&(i="after"),"lower"==i&&(i="before"),i="core/"+i);var s=this.complexeConditionObj.cbGetFieldTypeName(t),r=this.initializeConditionValues;jQuery(".ConditionValue",this.container).each((function(e,i){var t=$(i).data("name");void 0!==t&&void 0===r[t]&&(r[t]=$(i).val())}));var d,c="";if("function"===l){"object"===a(r)&&(void 0===r.value||-1==r.value.indexOf("return")?(d="$value = array();\n",jQuery.each(r,(function(e,i){d+="$value['"+e+"'] = '"+i+"';\n"})),r=d+="return $value;"):r=r.value);var u=(r.match(/\n/g)||[]).length;u<4&&(u=4),u>15&&(u=15),c+="<span class='customFunctionSpan'><textarea class='customFunction' style='width:100%;height:"+19*(u+1)+"px;' name='"+this.fieldNamePrefix+"[rawvalue]' id='"+this.fieldIdPrefix+"_rawvalue'>"+r+"</textarea></span>",c+="<label style='display:inline-block;'><img src='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAAAXNSR0IB2cksfwAAAAlwSFlzAAAOxAAADsQBlSsOGwAAAHtQTFRFAAAAAIUEAIUEAIUEAIUEAIUEAIUEAIUEAIUEAIUEAIUEAIUEAIUEAIUEAIUEAIUEAIUEAIUEAIUEAIUEAIUEAIUEAIUEAIUEAIUEAIUEAIUEAIUEAIUEAIUEAIUEAIUEAIUEAIUEAIUEAIUEAIUEAIUEAIUEAIUEAIUEIHjORgAAACl0Uk5TAGDm5Foc+//5FjgxB9TOBA9ubA0sKqCYLiYtJZ+XKykQcA76+F/l41l7yLOFAAAAZ0lEQVR4nGWPRxKDUAxDTRUQCPyEXgKBUO5/wlA2+sNbWRpbI4ucGKZlC+G4gOeTEWDnQUYYAc+YbxL1eotGmuk6BwrW5RFakVEfRsMrLdDpIZ9e18NXjaxvxW7VnQn48XMyL+t2TX/hiwRcoSKPsQAAAABJRU5ErkJggg==' style='margin-bottom:-2px;cursor:pointer;' onclick=\"insertTemplateField('"+this.fieldIdPrefix+"_rawvalue', '[source]->[module]->[destination]', false)\"></label>"}else"value"===l&&(jQuery.each(this.complexeConditionObj.conditionOperators[i].config,jQuery.proxy((function(e,i){var a=this,l=this.fieldNamePrefix+"[rawvalue]["+e+"]",d=this.fieldIdPrefix+"_"+e;void 0===r[e]&&(r[e]=""),void 0!==i.label&&(c+='<label class="condLabel">'+i.label+"</label>"),c+='<span class="'+(void 0!==i.length?i.length:"")+'">';var u=i.type;if("raw"!==this.getSelectedFieldmodifier()&&(u="textfield"),"default"===u)switch(s){case"multipicklist":case"picklist":case"owner":u="picklist";break;case"boolean":u="checkbox";break;case"date":case"datetime":u="datefield";break;case"reference":default:u="textfield"}switch(console.log("Draw Config Field",u),u){case"picklist":var A="",p=!1;if(void 0!==i.multiple&&1==i.multiple&&(A='multiple="multiple" data-closeonselect="0"',l+="[]",p=!0),c+="<select class='ConditionValue MakeSelect2' data-name='"+e+"' name='"+l+"' id='"+d+"' "+A+">",void 0!==i.options)var h=i.options;else h=this.complexeConditionObj.cbGetPicklistValues(t);var f=function(i){var t="";return t+="<option value=''>&nbsp;&nbsp;&nbsp;&nbsp;&raquo;&nbsp;&nbsp;"+a.complexeConditionObj.__("LBL_EMPTY_VALUE")+"</option>",t+="<optgroup label='"+a.complexeConditionObj.__("LBL_VALUES")+"'>",jQuery.each(i,(function(i,n){if(!1===p)var o=r[e]==i?"selected='selected'":"";else o=-1!==$.inArray(i,r[e])?"selected='selected'":"";t+="<option value='"+i+"' "+o+">"+n+"</option>"})),t};if(void 0!==h.then&&jQuery.isFunction(h.then))h.then($.proxy((function(i){var t=$.proxy(f,this)(i);jQuery("#"+this.id).html(t).select2("val",r[e])}),{id:d}));else{var m=$.proxy(f,this)(h);c+=m}c+="</optgroup>",c+="</select>";break;case"datefield":c+=function(e,i,t,o){void 0!==t&&null!=t||(t=""),0==i&&(i=e.replace(/[^a-zA-Z0-9_]+/g,"_")),void 0===o&&(o={}),void 0===o.refFields&&(o.refFields=!1),void 0===o.class&&(o.class=""),void 0===o.uitype&&(o.uitype=[]),void 0===o.style&&(o.style=""),void 0===o.disabled||0==o.disabled?o.disabled="":o.disabled="disabled='disabled'",void 0===o.type&&(o.type="0"),void 0===o.delimiter&&(o.delimiter=""),void 0===o.title&&(o.title=""),void 0===o.datalist&&(o.datalist=""),void 0===o.fieldType&&(o.fieldType="text"),void 0===o.readonly&&(o.readonly=!1),void 0===o.placeholder&&(o.placeholder=""),void 0===o.variables&&(o.variables=!0),void 0===o.format&&(o.format="%Y-%m-%d"),void 0===o.showTime&&(o.showTime=!1),void 0===o.dataAttr&&(o.dataAttr=!1),o.class+=" condition_value text textfield dateField templateField form-control";var a=o.uitype.join(","),l="";jQuery.each(o.dataAttr,(function(e,i){l+=" data-"+e+'="'+i+'"'}));var s="<input autocomplete='false' type='"+o.fieldType+"' "+l+" data-currentvalue='"+n(t)+"' "+(""!==o.datalist?'list="'+o.datalist+'"':"")+" title='"+o.title+"' placeholder='"+o.placeholder+"'  alt='"+o.title+"' data-delimiter='"+o.delimiter+"' ondblclick='dblClickTextfield(\""+i+"\");' "+o.disabled+"style='width:100% !important;float:left;"+o.style+"' data-module='"+o.module+"' class='"+o.class+"' name='"+e+"' id='"+i+"' "+(!0===o.readonly?'readonly="readonly"':"")+' value="'+(0!=t?n(t):"")+'">';return 1==o.variables&&("expression"!=o.mode?s+="<span class='templateFieldBtn templateFieldButton' data-references='([source]: ([module]) [destination])' data-functions='true' data-replace='false' data-options='{\"refFields\":\""+o.refFields+'", "module": "'+o.module+'", "uitypes": "'+a+'", "type":"'+o.type+"\"}' ><img src='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAQAAAC1+jfqAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAAmJLR0QAAKqNIzIAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAAHdElNRQfjBA8CIxxYy4paAAAAnElEQVQoz5WRsQ4BQRRFDzaUVBpbS0Qi0fkBH0Gz/ooOP6RSa9b4ACKxJHs1GztPZiTONPPunLzkvQGfFRfOLImQ8kKIgn4dNo2QANBmEO7Q4YgQh0oEoGGULhkle2511DJCwZ0Tjig7hNjEnieoOsPwFArcvtgixJofjBnZIDFVjzkljusfi/KZfaaYhoWUJ0I8/M+yZDhyFn70BtrhMDokCc6yAAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDE5LTA0LTE1VDAwOjM1OjI4KzAyOjAwZI0qbAAAACV0RVh0ZGF0ZTptb2RpZnkAMjAxOS0wNC0xNVQwMDozNToyOCswMjowMBXQktAAAAAZdEVYdFNvZnR3YXJlAHd3dy5pbmtzY2FwZS5vcmeb7jwaAAAAAElFTkSuQmCC' id='templateIcon_"+i+"'  style='margin-bottom:-5px;cursor:pointer;'></span>":s+="<span class='templateFieldBtn templateFieldButton' data-references='[source]->[module]->[destination]' data-functions='false' data-replace='false' data-options='{\"module\": \""+o.module+"\"}'  id='task_condition_iconspan'><img src='modules/Workflow2/icons/templatefieldPHP.png' style='margin-bottom:-2px;cursor:pointer;'>"),"<span class='templateFieldSpan'>"+s+"</span>"}(l,d,r[e],{showTime:"datetime"===s,format:"%Y-%m-%d",module:this.complexeConditionObj.getMainSourceModule(),fieldType:"text",dataAttr:{name:e},class:"ConditionValue",variables:this.complexeConditionObj.IsTemplateFieldsEnabled()});break;case"reference":if("Currency"==this.complexeConditionObj.fieldData[t].type.refersTo[0]&&void 0!==this.complexeConditionObj.available_currencies){c+="<select class='condition_value select' name='"+l+"' id='"+d+"'>";for(var v=0;v<this.complexeConditionObj.available_currencies.length;v++)c+="<option "+(r==this.complexeConditionObj.available_currencies[v].curid?"selected='selected'":"")+" value='"+this.complexeConditionObj.available_currencies[v].curid+"'>"+this.complexeConditionObj.available_currencies[v].currencylabel+"</option>";c+="</select>"}else c+=o(l,d,r[e],{refFields:!0,module:this.complexeConditionObj.getMainSourceModule(),dataAttr:{name:e},class:"ConditionValue",variables:this.complexeConditionObj.IsTemplateFieldsEnabled()});break;case"productid":c+=createProductChooser(l,d,r[e],{class:"ConditionValue"});break;default:void 0!==i.default&&""==r[e]&&1==this.initialized&&(r[e]=i.default),c+=o(l,d,r[e],{refFields:!0,module:this.complexeConditionObj.getMainSourceModule(),dataAttr:{name:e},class:"ConditionValue",variables:this.complexeConditionObj.IsTemplateFieldsEnabled()})}c+="</span>"}),this)),this.container.attr("data-columns",function(e){var i,t=0;for(i in e)e.hasOwnProperty(i)&&t++;return t}(this.complexeConditionObj.conditionOperators[i].config)));jQuery(".ConditionContainer",this.container).html(c),this.complexeConditionObj.InitSelect2(),jQuery("body").trigger("InitComponents")}},{key:"updateSelectedField",value:function(e){var i=jQuery(e.target),t=jQuery(i).closest(".ConditionalRecord");this.reloadOperations(t),this.updateValueModifier(t)}},{key:"getSelectedField",value:function(){return $("select.ConditionField, input.ConditionField",this.container).val()}},{key:"getSelectedFieldmodifier",value:function(){return 0==$("select.ConditionMod",this.container).length?"raw":$("select.ConditionMod",this.container).val()}},{key:"getSelectedOperator",value:function(){return $("select.ConditionOperation",this.container).val()}},{key:"getSelectedMode",value:function(){return $("select.ConditionMode",this.container).val()}},{key:"updateValueModifier",value:function(){var e=this.getSelectedFieldType(),i=this.getSelectedFieldmodifier();switch(e){case"date":case"datetime":var t={dayofmonth:"Day of month",month:"Month",dayofyear:"Day of year"};break;case"number":case"integer":case"decimal":case"currency":default:t={sum:"Summarize",avg:"Average",max:"Maximum",min:"Minimum",count:"Count",count_unique:"Count Unique"}}var n='<option value="raw">raw</option>';$.each(t,(function(e,t){n+='<option value="'+e+'" '+(i===e?'selected="selected"':"")+">"+t+"</option>"})),$(".ConditionMod",this.container).html(n)}},{key:"getSelectedFieldType",value:function(){var e=this.getSelectedField();return this.complexeConditionObj.cbGetFieldTypeName(e)}},{key:"reloadOperations",value:function(){var e=this.getSelectedOperator(),i=this.getSelectedField(),t=this.getSelectedFieldType(),n=[];switch("raw"!==this.getSelectedFieldmodifier()&&(t="string"),console.log("Changed field to",t,i),console.log(this.complexeConditionObj.operationOptions),t){case"integer":case"currency":n=this.complexeConditionObj.operationOptions.number;break;case"date":case"datetime":n=this.complexeConditionObj.operationOptions.date;break;case"multipicklist":case"crmid":case"picklist":case"boolean":n=this.complexeConditionObj.operationOptions[t];break;default:n=this.complexeConditionObj.operationOptions.text}for(var o="",a=0;a<n.length;a++){var l;l=void 0!==this.complexeConditionObj.conditionOperators[n[a]]?this.complexeConditionObj.conditionOperators[n[a]].label:n[a],l=this.complexeConditionObj.__(l),o+="<option value='"+n[a]+"' "+(void 0!==e&&e==n[a]?'selected="selected"':"")+">"+l+"</option>"}jQuery(".ConditionOperation",this.container).html(o).trigger("change")}}])&&l(i.prototype,t),s&&l(i,s),e}();function r(e,i){for(var t=0;t<i.length;t++){var n=i[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var d=function(){function e(i,t){!function(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}(this,e),void 0===t&&(t=!1),this.ownElementIndex=0,this.elementIndex=0,this.parentGroup=t,this.complexeConditionObj=i,this.backgroundColors=["f9f9f9","e7f4fe","d9d9d9","e7f4fe","b9b9b9","d9d9d9","e9e9e9","f9f9f9"],this.container=null,!1!==this.parentGroup?(this.ownElementIndex=this.parentGroup.getFreeElementIndex(),this.nestedLevel=this.parentGroup.getNestedLevel()+1,this.fieldPrefix=this.parentGroup.getGroupPrefix()+"["+this.ownElementIndex+"]",this.fieldIdPrefix=this.parentGroup.getGroupIdPrefix()+"_"+this.ownElementIndex):(this.nestedLevel=0,this.fieldPrefix=this.complexeConditionObj.getFieldnamePrefix(),this.fieldIdPrefix="root")}var i,t,n;return i=e,(t=[{key:"getElementIndex",value:function(){return this.ownElementIndex}},{key:"getFreeElementIndex",value:function(){return this.elementIndex++}},{key:"getBackgroundColor",value:function(){return"#"+this.backgroundColors[this.nestedLevel%this.backgroundColors.length]}},{key:"checkJoinDisabled",value:function(){0==$(".ConditionalRecord",this.container).length?$("> .btn-toolbar .joinSelector",this.container).prop("disabled",!0):$("> .btn-toolbar .joinSelector",this.container).prop("disabled",!1),!1!==this.parentGroup&&this.parentGroup.checkJoinDisabled()}},{key:"getNestedLevel",value:function(){return this.nestedLevel}},{key:"initialize",value:function(i){void 0!==i&&void 0!==i.childs&&($.each(i.childs,$.proxy((function(i,t){if(void 0!==t.childs){var n=new e(this.complexeConditionObj,this);n.appendTo($("> .CondContainer",this.container)),n.initialize(t)}else if(void 0!==t.field){var o=new s(this.complexeConditionObj,this);o.appendTo($("> .CondContainer",this.container)),o.initialize(t)}}),this)),this.setJoin(i.join))}},{key:"getJoin",value:function(){return $("> .btn-toolbar .ConditionalMasterJoin .joinSelector",this.container).val()}},{key:"setJoin",value:function(e){$("> .btn-toolbar .ConditionalMasterJoin .joinSelector",this.container).val(e).trigger("change")}},{key:"appendTo",value:function(e){var i="";i+="<div class='ConditionalItem ConditionalGroup "+(this.complexeConditionObj.isInitialized()?"NewConditionalGroup":"")+"' data-nestedlevel='"+this.nestedLevel+"' style='background-color:"+this.getBackgroundColor()+"'>",i+="<div class='CondContainer'></div>",i+="<div class='btn-toolbar' style='margin: 5px 0 0 0;'>",i+="<div class='btn-group conditionFooterToolbar'>",i+="<button type='button' class='btn btn-info addGroupBtn'><i class='icon-folder-open icon-white'></i>&nbsp;&nbsp;"+this.complexeConditionObj.__("LBL_ADD_GROUP")+"</button>",i+="<button type='button' class='btn btn-primary addConditionBtn'><i class='icon-plus-sign icon-white'></i>&nbsp;&nbsp;"+this.complexeConditionObj.__("LBL_ADD_CONDITION")+"</button>",i+=this.complexeConditionObj.generateJOINSelect(this.getGroupPrefix(!0),!0),i+="</div>",this.nestedLevel>0&&(i+="<div class='btn-group pull-right'><button type='button' class='btn btn-danger groupRemoveBtn'><i class='icon-remove icon-white'></i>&nbsp;&nbsp;"+this.complexeConditionObj.__("LBL_REMOVE_GROUP")+"</button></div>"),i+="</div>",i+="</div>",i+=this.complexeConditionObj.generateJOINSelect("",!1),this.container=$(i),this.container.data("item",this),$(e).append(this.container),this.checkJoinDisabled();var t=$("> .btn-toolbar",this.container);$(".addGroupBtn",t).on("click",$.proxy(this.BtnClickAddGroup,this)),$(".addConditionBtn",t).on("click",$.proxy(this.BtnClickAddCondition,this)),$(".ConditionalMasterJoin",t).on("change",$.proxy(this.ChangeMasterJoin,this)),$(".groupRemoveBtn",t).on("click",$.proxy(this.BtnClickRemoveGroup,this)),$(".ConditionalSubJoin",e).off("change").on("change",this.complexeConditionObj.ChangeJoin),$(".NewConditionalGroup",e).slideDown("fast").removeClass("NewConditionalGroup")}},{key:"isGroup",value:function(){return!0}},{key:"ChangeMasterJoin",value:function(e){var i=$(e.target);$(i).closest(".ConditionalGroup"),$("> .CondContainer > .ConditionalJoin select",this.container).val(i.val())}},{key:"BtnClickAddCondition",value:function(e){new s(this.complexeConditionObj,this).appendTo($("> .CondContainer",this.container)),this.checkJoinDisabled()}},{key:"BtnClickAddGroup",value:function(i){new e(this.complexeConditionObj,this).appendTo($("> .CondContainer",this.container))}},{key:"BtnClickRemoveGroup",value:function(){var e=this,i=this;this.container.slideUp("slideUp",(function(){jQuery(e).remove(),i.checkJoinDisabled()}))}},{key:"getGroupIdPrefix",value:function(){return this.fieldIdPrefix}},{key:"getCondition",value:function(){var e={};return jQuery("> .CondContainer > .ConditionalItem",this.container).each((function(i,t){var n=$(t).data("item");if(n.isGroup())e[n.getElementIndex()]={join:n.getJoin(),childs:n.getCondition()};else{var o={field:n.getField(),mod:n.getModifier(),not:n.getNot(),operation:n.getOperation(),mode:n.getMode(),rawvalue:n.getValues()};e[n.getElementIndex()]=o}})),e}},{key:"getGroupPrefix",value:function(e){if(void 0===e&&(e=!1),!1===e)var i=this.fieldPrefix+"[childs]";else i=this.fieldPrefix;return i}}])&&r(i.prototype,t),n&&r(i,n),e}(),c={};function u(e,i){if(void 0===i)i=!1;if(void 0!==e&&0!=jQuery("#"+e).length){var t=jQuery("#pageOverlay");jQuery("#pageOverlayContent");1!=i?t.animate({opacity:0}):t.hide()}else jQuery("#pageOverlay").hide("fast")}var A=function(e,i,t,n,o,a){var l=e.getScopeName(),s=e.getSourcePlaceholders();if(!jQuery(i).attr("readonly")){if("undefined"!=typeof workflowModuleName)var r=workflowModuleName;if(void 0!==a&&void 0!==a.module&&"undefined"!=a.module&&(r=a.module),void 0===r&&(r=moduleName),void 0!==r){var d;void 0===a&&(a={}),d="function"==typeof a.callback?a.callback:null,null==t&&(t="[source]->[module]->[destination]"),null==n&&(n=!1),null==o&&(o=!1),n=0==n?0:1,void 0===a.type&&(a.type="0"),void 0===a.refFields&&(a.refFields="false"),void 0===a.uitypes&&(a.uitypes="");var A=a.uitypes.split(","),p=t+";;"+r+";;"+a.type+";;"+a.uitypes+";;"+a.refFields+";;functions"+n;0==jQuery("#insertTemplateFieldContainer").length&&jQuery("body").append("<div id='insertTemplateFieldContainer' style='display:none;'></div>"),void 0===c[p]&&(jQuery.ajaxSetup({async:!1}),jQuery("#insertTemplateFieldContainer").load("index.php?module="+l+"&action=TemplateVariables&mode=templateFields",{functions:n,uitypes:A,type:a.type,refFields:a.refFields,reftemplate:t,mainModule:r,additionalPlaceholders:s}),jQuery.ajaxSetup({async:!0}),c[p]=jQuery("#insertTemplateFieldContainer").html()),jQuery("#insertTemplateFieldContainer").html(c[p]),function(e,i,t,n,o){var a=jQuery.Deferred();if(0==(r=jQuery("#pageOverlay")).length){var l=$("<div id='pageOverlay' style='cursor:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAAV1BMVEUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOl5NtAAAAHXRSTlP+APnw7+XGwJNGQCZ4tZ6dnFgaGAjR0M97WlfSdwzyPaoAAACHSURBVBjTZU9bEoQgDAsF5KWIILqv+59zi7ozy5ivTNqmCQTD2ypltb5xFnLUBAbpmJuQJ4kLaiosRAk6NwgqCXgNmscBGMaZoD0sgR7hZcwzjEwt3uDhEpwLy8B0w+Fo3Lo6c/jehdqf7P+mn2Z6fyui6oNxdNVHFyX9yqUixFV/k3I/638BJxkF+5eYS7cAAAAASUVORK5CYII=), auto;position:fixed;z-index:1500;top:0;left:0;display:none;height:100%;width:100%;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAJYAAACWBAMAAADOL2zRAAAAElBMVEXCw8TT09PPz8/FxcbLy8zIyMmv866aAAAABnRSTlOwsLCwsLCTI7FOAAAETUlEQVRo3u1ZQZLiMAxUVcgDQvGBeLL3qQ08IENxT0H+/5YdTKCtakv23s0plOy4LSnqli2zPH/3cfj9XePzJT6fvp/P3c/z+fiIhnM0fEVDH5JB9+E1+0/8e1me/6YHTMdrMn8fFF8cXoO2OOj2jdUnOT0ATM9nYFs03BJgUzpIjvuaMNnAuhTYe3UAk2Fa498dczJ/ygHDoP7llhWD5NdnL8yJx+WezD+kwF6D9njtHv/MFjiTME96YwCGUCi3SNaZolMBwPpo4HhF9ELO5FDQi3W85vdsQZaYOcbApmyOCTvTz7G/0aDjtQ8Sy5kqeYMelI9XkNSZyvRjADunyZ+uvilndjDhxYgxJ7+c00H7ZiaV19aOH/tmMEiF4o35+l4TyZ/O73UoEK8zilU0jYQ5CwyDArllFoFpuEmCeeVQ7B7D6qeVPvdPlBhzTzumAqvcAsw3CmXnA5s4lHg1Rxk5hjqk0evV8cEWgNGgYAOb2JmXhSp3Op/ita/JzgRbZJL/nosXk4JK/tGiFK4JD7HYirnWL7Dg2lmx1ZAkv0FJHYCBa00aBVthY37lF12ikONgK5dSvpKwCNiKKr/vca788olySDCn8w9+5b+h8gswU5R9dcGJJLuJyk21ukDyiy/V+KvmHX/UoChnslSrVxfLIMmad1OqjUbyB5VjEmCa4Qyqg1lK6rQCjWC8SuIXWBUvVUmE2YoLrFr9kBKiZiuunVN2xxh0RyieJqZRa8eYn1UX2pm2unA9BmDMVmF3ZgCwvLoAiYsI57VZ+UldUPLDmR6NltUFPOazFQHjeIHS2BRWJvFgciU8Bsxk8pP/SKsbzrST346XhRmfO9qBQakLzrGqPuVW1VcK83P3xkwNs24mqFiJ06ewuvArv7jtAFKhpvJLjka7hdWF31eeNdcyZlYXvuwRr/s3zi6svlLIZDUza7GvFMOZdi9st2+Sd2Z3Hkiqza7smZdBVMtp5JhKfouEt1HojIekGgosh0Lt2GugAMwrsFidaJSS36CkB2v+LL8zjZaBFTAjx+rUBdIHmFlao8DS5+4AU2wTato3+LvMVifymKEuYGIaBVf66gLo66VaXSj7saoXZmlNs20axY7LyR/IY6ZUAzDaMeKVqyQsrbH+4PSVcc1in6J6YauvlEIv3AWq/CY9SIGtuq26fTsK5tefgjpcy8CW9MUDgPUjA8MgcZp0v/JzvEQ36ba6uJb7SgFbaWdYfaVzOCyVUo0LrM+1nPxK9swl2SMGjfaKRoPOMQBL3LIFoT6lpC42ltb7oLpT0EtGWnOxqj0FHehwmIuVyVbl9o2+Kr1m/Skon1obfcpkqguu/Fj9/45nfXXBznR74YGS3wRW7oUn93CYMfskzurCAza46mJlYAsGVWpITn4GxlLNbTlP9ql1u2Ntd6ztjrXdsbY71nbH2u5Y2x1ru2Ntd6ztjrXdsbY71nbH2u5YX8n/D4wVYjMqONy+AAAAAElFTkSuQmCC);'><div id='pageOverlayContent' style='position:fixed;cursor:default;top:100px;margin:auto;left:50%;padding:10px;background-color:#ffffff;'>&nbsp;</div></div>");l.on("click",(function(){u()})),jQuery("body").append(l)}if(void 0===s)var s=!1;e+="<br>",e+='<div class="btn-group pull-right" style="text-align:center;margin-top:5px;padding:0 10px 10px;">',e+='<button class="btn btn-warning BtnCancel" onclick="">'+i.cancel+"</button>",e+='<button class="btn btn-success BtnOk">'+i.ok+"</button>",e+="</div>";var r=jQuery("#pageOverlay"),d=jQuery("#pageOverlayContent");return e='<img class="closePageOverlay" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAAV1BMVEUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOl5NtAAAAHXRSTlP+APnw7+XGwJNGQCZ4tZ6dnFgaGAjR0M97WlfSdwzyPaoAAACHSURBVBjTZU9bEoQgDAsF5KWIILqv+59zi7ozy5ivTNqmCQTD2ypltb5xFnLUBAbpmJuQJ4kLaiosRAk6NwgqCXgNmscBGMaZoD0sgR7hZcwzjEwt3uDhEpwLy8B0w+Fo3Lo6c/jehdqf7P+mn2Z6fyui6oNxdNVHFyX9yqUixFV/k3I/638BJxkF+5eYS7cAAAAASUVORK5CYII=" style="position:absolute;right:-5px;top:-5px;cursor:pointer;">'+e,"none"==r.css("display")?(d.css("width",t+"px"),d.css("marginLeft",t/2*-1+"px"),d.css("visibility","hidden"),r.css("opacity","0"),d.show(),r.show(),d.html(e),0!=s&&jQuery(s).length>0?(r.animate({opacity:1}),jQuery(s).effect("transfer",{to:d},250,(function(){d.css("visibility","visible")}))):(d.css("visibility","visible"),r.css("opacity","1"),r.show())):(d.html(e),d.animate({width:t+"px",marginLeft:t/2*-1+"px"},"fast",(function(){}))),d.find(".closePageOverlay").on("click",(function(){u()})),jQuery(".BtnCancel").on("click",(function(e){u(),a.resolve(!1)})),jQuery(".BtnOk").on("click",(function(e){jQuery(".ModalResultValue","#pageOverlayContent").hasClass("chzn-select")?a.resolve("$"+jQuery(".ModalResultValue","#pageOverlayContent").select2("val")):a.resolve("$"+jQuery(".ModalResultValue","#pageOverlayContent").val()),u()})),jQuery("#pageOverlayContent").on("click.select2",(function(e){e.preventDefault(),e.stopPropagation()})),jQuery("#pageOverlayContent").on("click",(function(e){e.preventDefault(),e.stopPropagation()})),a.promise()}(jQuery("#insertTemplateFieldContainer").html(),{ok:"OK",cancel:"abbrechen"},500,i.parent().find(".templateFieldButton")).then((function(e){if(!1!==e){var t=i.data("delimiter");if("function"==typeof d)if(!1===d(e,{field:i.attr("id"),replace:o}))return;if(1==o)i.val(e);else{var n=i.val();void 0!==t&&n.length>0&&(n+=t),i.val(n+e)}i.trigger("insertText",[e]),i.trigger("change"),i.trigger("blur")}})),jQuery("#pageOverlayContent select.chzn-select").select2(),jQuery("#pageOverlayContent").on("click",(function(e){e.stopPropagation()}))}}};function p(e){return(p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function h(e,i){for(var t=0;t<i.length;t++){var n=i[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var f="",m=function(){function e(i,t){!function(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}(this,e),this.initialized=!1,this.conditionOperators=null,this.operationOptions={picklist:[],multipicklist:[],boolean:[],number:[],date:[],text:[],crmid:[]},this.hasChanged=!1,this.moduleFields=null,this.available_currencies=null,this.available_users=null,this.parentEle=jQuery(i),this.fieldOptionsHTMLCache=null,this.fieldNamePrefix=t,this.conditionMode="field",this.requiredOnInit=[],this.condition={},this.checkReferenceFields=!0,this.fieldData={},this.enableTemplateFields=!0,this.environmentVariables=[],this.DisabledConditionMode=!1,this.dynamicFieldMode=!1,this.enableValueModifier=!1,this.columnsRewrites={assigned_user_id:"smownerid"},"undefined"==typeof MOD?this.MOD={}:this.MOD=MOD,this.sourcePlaceholders=[],this.mainCheckModule=null,this.mainSourceModule=null,this.imagePath="",this.mainGroup=!1}var i,t,n;return i=e,(t=[{key:"addSourcePlaceholder",value:function(e,i){this.sourcePlaceholders.push({placeholder:e,label:i})}},{key:"getSourcePlaceholders",value:function(){return this.sourcePlaceholders}},{key:"disableReferenceCheckFields",value:function(){this.checkReferenceFields=!1}},{key:"cbGetFieldTypeName",value:function(e){return void 0!==this.fieldData[e]?this.fieldData[e].type.name:"text"}},{key:"cbGetPicklistValues",value:function(e){return this.fieldData[e].type.picklistValues}},{key:"setFieldnamePrefix",value:function(e){this.fieldNamePrefix=e}},{key:"getCondition",value:function(){return{join:this.mainGroup.getJoin(),childs:this.mainGroup.getCondition()}}},{key:"setTranslation",value:function(e){this.MOD=e}},{key:"setEnabledTemplateFields",value:function(e){this.enableTemplateFields=1==e}},{key:"disableConditionMode",value:function(){this.DisabledConditionMode=!0}},{key:"enableValueModifier",value:function(){this.enableValueModifier=!0}},{key:"setImagePath",value:function(e){this.imagePath=e}},{key:"setScopeName",value:function(e){f=e,""===this.imagePath&&this.setImagePath("modules/"+f+"/views/resources/img/")}},{key:"getScopeName",value:function(){return f}},{key:"setConditionMode",value:function(e){this.conditionMode="field"==e?"field":"mysql"}},{key:"setMainCheckModule",value:function(e){this.mainCheckModule!==e&&(this.mainCheckModule=e,this.moduleFields=null,this.fieldOptionsHTMLCache=null)}},{key:"setMainSourceModule",value:function(e){this.mainSourceModule=e}},{key:"enableHasChange",value:function(e){this.hasChanged=1==e}},{key:"setFieldTypeCallback",value:function(e){"function"!=typeof e&&console.error("Field type callback must be function"),this.cbGetFieldTypeName=e}},{key:"setAvailableVariables",value:function(e){!1!==e?(this.setEnabledTemplateFields(!0),e):this.setEnabledTemplateFields(!1)}},{key:"setParentEle",value:function(e){this.parentEle=$(e)}},{key:"setPicklistCallback",value:function(e){"function"!=typeof e&&console.error("Picklist callback must be function"),this.cbGetPicklistValues=e}},{key:"setAvailableCurrencies",value:function(e){this.available_currencies=e}},{key:"setAvailableUser",value:function(e){this.available_users=e}},{key:"setModuleFields",value:function(e){var i=this;"function"==typeof e&&(this.dynamicFieldMode=!0),this.moduleFields=e,"object"==p(e)&&(this.fieldData={},jQuery.each(this.moduleFields,(function(e,t){jQuery.each(t,(function(e,t){void 0!==i.columnsRewrites[t.name]&&(t.name=i.columnsRewrites[t.name]),"string"==typeof t.type&&(t.type={name:t.type}),"crmid"!=t.name&&-1===t.name.indexOf(" crmid)")||(t.type={name:"crmid"}),i.fieldData[t.name]=t}))})))}},{key:"setEnvironmentVariables",value:function(e){this.environmentVariables=e}},{key:"clearCondition",value:function(){this.condition={},this._AfterLoadFields()}},{key:"setCondition",value:function(e){if(void 0!==e){if(void 0===e.childs){var i=[];$.each(e,(function(e,t){"object"===p(t)&&""!==t.operator&&void 0!==t.field&&""!=t.field&&(t.field=JSON.parse(t.field),"string"==typeof t.field&&(t.field=JSON.parse(t.field)),i.push({field:t.field.fieldkeyid,mod:t.mod,operation:t.operator,not:t.not,mode:"value",rawvalue:t.config}))})),e={join:"and",childs:i}}this.condition=e}}},{key:"setConditionOperators",value:function(e){var i=this;this.conditionOperators=e,$.each(e,(function(e,t){"all"===t.fieldtypes?$.each(i.operationOptions,(function(t,n){i.operationOptions[t].push(e)})):$.each(t.fieldtypes,(function(t,n){void 0!==i.operationOptions[n]&&i.operationOptions[n].push(e)}))})),this.operationOptions.owner=this.operationOptions.picklist,this.operationOptions.crmid=jQuery.merge(jQuery.extend([],this.operationOptions.number),jQuery.extend([],this.operationOptions.crmid)),this.operationOptions.crmid=jQuery.grep(this.operationOptions.crmid,(function(e,t){return t==i.operationOptions.crmid.indexOf(e)}))}},{key:"isInitialized",value:function(){return this.initialized}},{key:"IsTemplateFieldsEnabled",value:function(){return this.enableTemplateFields}},{key:"getFieldnamePrefix",value:function(){return this.fieldNamePrefix}},{key:"getMainSourceModule",value:function(){return this.mainSourceModule}},{key:"getMainCheckModule",value:function(){return this.mainCheckModule}},{key:"getFieldOptions",value:function(){var e=this;if(null===this.fieldOptionsHTMLCache){var i="";jQuery.each(this.moduleFields,(function(t,n){i+="<optgroup label='"+t+"'>";for(var o=0;o<e.moduleFields[t].length;o++)void 0!==e.columnsRewrites[e.moduleFields[t][o].name]&&(e.moduleFields[t][o].name=e.columnsRewrites[e.moduleFields[t][o].name]),i+="<option value='"+e.moduleFields[t][o].name+"'>"+e.moduleFields[t][o].label+"</option>";i+="</optgroup>"})),"object"==p(this.environmentVariables)&&this.environmentVariables.length>0&&(i+="<optgroup label='Environment Variables'>",jQuery.each(this.environmentVariables,(function(e,t){i+="<option value='"+t+"'>"+t+"</option>"})),i+="</optgroup>"),this.fieldOptionsHTMLCache=i}return this.fieldOptionsHTMLCache}},{key:"IsConditionModeVisible",value:function(){return!1===this.DisabledConditionMode}},{key:"IsValueModifiersVisible",value:function(){return!0===this.enableValueModifier}},{key:"IsDynamicFieldLoader",value:function(){return this.dynamicFieldMode}},{key:"__",value:function(e){if(void 0!==this.MOD[e])return this.MOD[e];if("undefined"!=typeof FlexTranslate){var i=null;try{i=FlexTranslate(f)}catch(i){return e}return void 0!==i?i.__(e):e}return e}},{key:"_AfterLoadFields",value:function(){var e=this;this.parentEle.hide(),this.currentParentGroupId="root",this.initValues=[],this._PrepareParentEle(),this.mainGroup=new d(this,!1),this.mainGroup.appendTo(this.parentEle),this.mainGroup.initialize(this.condition),this.parentEle.fadeIn("fast",(function(){e.InitSelect2()})),this.initialized=!0,this.enableTemplateFields&&"undefined"!=typeof InitAutocompleteText&&InitAutocompleteText(),this.parentEle.on("click",".templateFieldButton",(function(i){var t=jQuery(i.currentTarget),n=t.closest(".templateFieldSpan,.templateTextareaSpan").find(".templateField"),o=(n.attr("id"),t.data("options"));A(e,n,t.data("references"),!0===t.data("functions"),!0===t.data("replace"),o)}))}},{key:"_RequireOnInit",value:function(e){this.requiredOnInit.push(e)}},{key:"_PrepareParentEle",value:function(){var e=this,i='<div class="ConditionControlPanel"><strong>Options:&nbsp;&nbsp;</strong>';i+='<label><input type="checkbox" class="ConditionJoinCollapse" checked="checked" /> '+this.__("Collapse logical operators")+"</label>",i+="</div>",this.parentEle.html(i),$(".ConditionJoinCollapse",this.parentEle).on("change",(function(i){1==$(i.target).prop("checked")?$(e.parentEle).addClass("ConditionCollapseJoins").removeClass("ConditionExpandJoins"):$(e.parentEle).removeClass("ConditionCollapseJoins").addClass("ConditionExpandJoins")})).trigger("change")}},{key:"ChangeJoin",value:function(e){var i=jQuery(e.target),t=jQuery(i).closest(".ConditionalGroup");t.children(".CondContainer").children(".ConditionalJoin").find("select").val(i.val()),jQuery("> .btn-toolbar .ConditionalMasterJoin select",t).val(i.val())}},{key:"InitSelect2",value:function(){var e,i=this;(e=$(".MakeSelect2",this.parentEle)).removeClass("MakeSelect2"),e.each((function(e,i){$(i).select2({closeOnSelect:"0"!=$(i).data("closeonselect")})})),!0===this.dynamicFieldMode&&((e=$(".MakeHiddenSelect2.ConditionField",this.parentEle)).removeClass("MakeHiddenSelect2"),e.each((function(e,t){$(t).select2({closeOnSelect:"0"!=$(t).data("closeonselect"),initSelection:function(e,t){var n=i.moduleFields(e.val(),!0);void 0!==n.id&&t(n)},query:function(e){var t=i.moduleFields(e.term,!1);e.callback(t)}})})))}},{key:"init",value:function(){var e=this,i=document.documentElement.style;("flexWrap"in i||"WebkitFlexWrap"in i||"msFlexWrap"in i)&&jQuery(this.parentEle).addClass("supportFlexbox"),null===this.conditionOperators&&this._RequireOnInit("operators"),null===this.moduleFields&&this._RequireOnInit("fields"),null===this.available_users&&this._RequireOnInit("users"),this.requiredOnInit.length>0?$.post("index.php?module="+f+"&action=ComplexeCondition&mode=init",{mainModule:this.mainCheckModule,conditionMode:this.conditionMode,required:this.requiredOnInit,referenceFields:!0===this.checkReferenceFields?1:0},(function(i){void 0!==i.operators&&e.setConditionOperators(i.operators),void 0!==i.fields&&e.setModuleFields(i.fields),void 0!==i.users&&(e.available_users=i.users),e.fieldData.smownerid.type.name="picklist",e.fieldData.smownerid.type.picklistValues=e.available_users,e._AfterLoadFields()}),"json"):"function"!=typeof this.moduleFields?this.LoadFields().then(jQuery.proxy(this._AfterLoadFields,this)):this._AfterLoadFields()}},{key:"generateJOINSelect",value:function(e,i){void 0===i&&(i=!1);var t="<div class='ConditionalJoin ConditionalSubJoin "+(!0===i?"ConditionalMasterJoin":"")+"'>";return t+=!0===i?"<select class='joinSelector' disabled='disabled' name='"+e+"[join]'>":"<select class='joinSelector' disabled='disabled' >",t+="<option value='and'>"+this.__("LBL_AND")+"</option>",t+="<option value='or'>"+this.__("LBL_OR")+"</option>",t+="</select>",t+="</div>"}}])&&h(i.prototype,t),n&&h(i,n),e}();function v(e,i){for(var t=0;t<i.length;t++){var n=i[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var y=function(){function e(){return function(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}(this,e),this.conditionObj=new m("#conditionpopupContainer","condition"),this.title="Condition",this.callbacks={close:function(e){return e}},new Proxy(this,{get:function(e,i){return i in e?e[i]:"function"==typeof e.__noSuchMethod__?function(){for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return e.__noSuchMethod__.call(e,i,n)}:void 0}})}var i,t,n;return i=e,(t=[{key:"setTitle",value:function(e){this.title=e}},{key:"onClose",value:function(e){this.callbacks.close=e}},{key:"open",value:function(){var e=this,i='<div class="modal-dialog modelContainer" id="conditionPopup" style="width:800px;">';i+='    <div class="modal-header">\n        <div class="clearfix">\n            <div class="pull-right " >\n                <button type="button" class="close" aria-label="Close" data-dismiss="modal">\n                    <span aria-hidden="true" class=\'fa fa-close\'></span>\n                </button>\n            </div>\n            <h4 class="pull-left">'+this.title+"</h4>\n        </div>\n    </div>\n",i+='<div class="modal-content">',i+='<div id="conditionpopupContainer"></div>',i+='<div class="modal-footer" style="text-align:center;">',i+='<button class="btn btn-success closeConditionPopup" type="submit" name="saveButton"><strong>'+this.conditionObj.__("LBL_BTN_SAVE")+"</strong></button>",i+='<a href="#" class="cancelLink" type="reset" data-dismiss="modal">'+this.conditionObj.__("LBL_CLOSE")+"</a>",i+="</div>",i+="</div>",i+="</div>",console.log("open ConditionPopup Modal"),app.helper.showModal(i,{cb:function(i){console.log("callback init ConditionPopup"),$(".closeConditionPopup").on("click",(function(){e.callbacks.close(e.conditionObj.getCondition()),app.helper.hideModal()})),e.conditionObj.setParentEle("#conditionpopupContainer"),e.conditionObj.init()}})}},{key:"__noSuchMethod__",value:function(e,i){this.conditionObj[e].apply(this.conditionObj,i)}}])&&v(i.prototype,t),n&&v(i,n),e}();t("dNbJ"),window.ComplexeCondition=m,window.ComplexeConditionPopup=y},dNbJ:function(e,i,t){}});